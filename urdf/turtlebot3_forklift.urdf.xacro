<?xml version="1.0" ?>
<robot name="turtlebot3_forklift" xmlns:xacro="http://ros.org/wiki/xacro">
  <!-- Include TurtleBot3 Burger Model -->
  <xacro:include filename="$(find turtlebot3_description)/urdf/turtlebot3_burger.urdf.xacro"/>

  <!-- Forklift Properties -->
  <xacro:property name="mast_height" value="1.2"/> <!-- SUPER TALL MAST for 1m reach -->
  <xacro:property name="mast_width" value="0.04" />
  <xacro:property name="mast_depth" value="0.02" />
  <xacro:property name="fork_length" value="0.15" />
  <xacro:property name="fork_width" value="0.1" />
  <xacro:property name="fork_thickness" value="0.01" />

  <!-- 1. Lift Mast (Dikey Direk) -->
  <!-- Fixed to the base of the robot -->
  <joint name="mast_joint" type="fixed">
    <parent link="base_link"/>
    <child link="lift_mast"/>
    <origin xyz="0.08 0 0.18" rpy="0 0 0"/>
  </joint>

  <link name="lift_mast">
    <!-- Left Pole -->
    <visual>
      <origin xyz="0 0.05 0.6" rpy="0 0 0"/>
      <geometry>
        <box size="${mast_depth} 0.01 ${mast_height}"/>
      </geometry>
      <material name="dark_grey">
        <color rgba="0.2 0.2 0.2 1.0"/>
      </material>
    </visual>
    <!-- Right Pole -->
    <visual>
      <origin xyz="0 -0.05 0.6" rpy="0 0 0"/>
      <geometry>
        <box size="${mast_depth} 0.01 ${mast_height}"/>
      </geometry>
      <material name="dark_grey"/>
    </visual>
    <!-- Top Bar (Optional, to connect them) -->
    <visual>
      <origin xyz="0 0 1.19" rpy="0 0 0"/>
      <geometry>
        <box size="${mast_depth} 0.11 0.02"/>
      </geometry>
      <material name="dark_grey"/>
    </visual>
    <!-- Collision DISABLED to prevent stuck robot
    <collision>
      <origin xyz="0 0 0.6" rpy="0 0 0"/>
      <geometry>
        <box size="${mast_depth} ${mast_width} ${mast_height}"/>
      </geometry>
    </collision>
    -->
    <inertial>
      <mass value="0.01"/> <!-- Reduced from 0.1 -->
      <origin xyz="0 0 0"/>
      <inertia ixx="0.001" ixy="0.0" ixz="0.0"
               iyy="0.001" iyz="0.0"
               izz="0.001" />
    </inertial>
  </link>

  <!-- 2. Lift Fork (Çatal) -->
  <!-- Moves vertically (Prismatic Joint) -->
  <joint name="fork_joint" type="prismatic">
    <parent link="lift_mast"/>
    <child link="fork_link"/>
    <origin xyz="0.04 0 -0.15" rpy="0 0 0"/> <!-- Lowered to -0.15 to reach ground -->
    <axis xyz="0 0 1"/>
    <!-- Range of motion: 0 to 1.3m (adjusted for lower start) -->
    <limit lower="0.0" upper="1.3" effort="20" velocity="0.2"/>
    <dynamics damping="0.1" friction="0.1"/>
  </joint>

  <link name="fork_link">
    <!-- Horizontal plate -->
    <visual>
      <origin xyz="${fork_length/2} 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="${fork_length} ${fork_width} ${fork_thickness}"/>
      </geometry>
      <material name="red">
        <color rgba="0.8 0.1 0.1 1.0"/>
      </material>
    </visual>
    <!-- Collision DISABLED to prevent physics bugs
    <collision>
      <origin xyz="${fork_length/2} 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="${fork_length} ${fork_width} ${fork_thickness}"/>
      </geometry>
    </collision>
    -->
    <!-- Back plate (connection to mast) -->
    <visual>
      <origin xyz="0 0 0.05" rpy="0 0 0"/>
      <geometry>
        <box size="0.01 ${fork_width} 0.1"/>
      </geometry>
      <material name="red"/>
    </visual>
    <inertial>
      <mass value="0.01"/> <!-- Reduced from 0.05 -->
      <origin xyz="0.05 0 0"/>
      <inertia ixx="0.0001" ixy="0.0" ixz="0.0"
               iyy="0.0001" iyz="0.0"
               izz="0.0001" />
    </inertial>
  </link>

  <!-- 5. Counterweight (Denge Ağırlığı) -->
  <joint name="counterweight_joint" type="fixed">
    <parent link="base_link"/>
    <child link="counterweight_link"/>
    <origin xyz="-0.1 0 0.15" rpy="0 0 0"/> <!-- Raised to prevent dragging -->
  </joint>

  <link name="counterweight_link">
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="0.05 0.1 0.05"/>
      </geometry>
      <material name="dark_grey"/>
    </visual>
    <!-- Collision DISABLED
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="0.05 0.1 0.05"/>
      </geometry>
    </collision>
    -->
    <inertial>
      <mass value="0.1"/> <!-- Reduced from 2.0 -->
      <origin xyz="0 0 0"/>
      <inertia ixx="0.01" ixy="0.0" ixz="0.0"
               iyy="0.01" iyz="0.0"
               izz="0.01" />
    </inertial>
  </link>

  <!-- 6. Custom Camera Sensor -->
  <joint name="custom_camera_joint" type="fixed">
    <parent link="fork_link"/>
    <child link="custom_camera_link"/>
    <!-- Positioned relative to FORK (moving) -->
    <origin xyz="0.05 0 0.1" rpy="0 0 0"/>
  </joint>

  <link name="custom_camera_link">
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="0.01 0.03 0.03"/>
      </geometry>
      <material name="blue">
        <color rgba="0.0 0.0 1.0 1.0"/>
      </material>
    </visual>
  </link>

  <!-- Gazebo Plugin for Camera -->
  <gazebo reference="custom_camera_link">
    <sensor type="camera" name="custom_camera">
      <update_rate>30.0</update_rate>
      <camera name="head">
        <horizontal_fov>1.3962634</horizontal_fov>
        <image>
          <width>640</width>
          <height>480</height>
          <format>R8G8B8</format>
        </image>
        <clip>
          <near>0.02</near>
          <far>300</far>
        </clip>
        <noise>
          <type>gaussian</type>
          <mean>0.0</mean>
          <stddev>0.007</stddev>
        </noise>
      </camera>
      <plugin name="camera_controller" filename="libgazebo_ros_camera.so">
        <alwaysOn>true</alwaysOn>
        <updateRate>0.0</updateRate>
        <cameraName>custom_camera</cameraName>
        <imageTopicName>image_raw</imageTopicName>
        <cameraInfoTopicName>camera_info</cameraInfoTopicName>
        <frameName>custom_camera_link</frameName>
        <hackBaseline>0.07</hackBaseline>
        <distortionK1>0.0</distortionK1>
        <distortionK2>0.0</distortionK2>
        <distortionK3>0.0</distortionK3>
        <distortionT1>0.0</distortionT1>
        <distortionT2>0.0</distortionT2>
      </plugin>
    </sensor>
  </gazebo>

  <!-- 3. Transmission (Motor Control Interface) -->
  <transmission name="fork_trans">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="fork_joint">
      <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
    </joint>
    <actuator name="fork_motor">
      <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
  </transmission>

  <!-- 4. Gazebo Plugin for ros_control -->
  <gazebo>
    <plugin name="gazebo_ros_control" filename="libgazebo_ros_control.so">
      <robotNamespace>/</robotNamespace>
    </plugin>
  </gazebo>

</robot>
